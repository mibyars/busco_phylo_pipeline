## Get list of complete BUSCO's for each species & prep list of busco genes to extract
for file in /projects/tollis_lab/pns53_squamates/busco_output/busco/*/*run_*/full_table*.tsv; do grep -v "^#" ${file} | awk '$2=="Complete" {print $1}' >> /scratch/mib75/squamates/round2_data/complete_busco_ids.txt; done
sort complete_busco_ids.txt | uniq -c > complete_busco_ids_with_counts
awk '$NF > 2 {print $2}' complete_busco_ids_with_counts > final_busco_ids
## Copy single_copy_busco_sequences into a new directory and append the appropriate genSpe abbreviation to each file
for dir in $(find -type d -name "single_copy_busco_sequences"); do  genSpe=$(dirname $dir | cut -c 3-8);  for file in ${dir}/*.fna; do cp ${file} /scratch/mib75/squamates/round2_data/busco_nt/${genSpe}_$(basename ${file}); sed -i 's/^>/>'${genSpe}'|/g' /scratch/mib75/squamates/round2_data/busco_nt/${genSpe}_$(basename ${file}); done; done
## Merge the BUSCO nucleotide fasta sequences together - (each file will have the same BUSCO sequence from different species) 
while read line; do cat busco_nt/??????_${line}.fna >> busco_nt_merged/${line}_nt.fasta; done < final_busco_ids
## Generate MAFFT commands and run with parallel 
for i in *.fasta; do echo 'mafft --auto ' ${i} ' > ' ${i}'.mafft.out' >> commands; done
for i in *fasta.mafft.out; do echo 'trimal -automated1 -in ' ${i} ' -out ' ${i}'.mafft.trimmed' >> trimal_commands; done
## Generate AMAS commands and run with parallel
for i in *mafft.trimmed; do echo 'AMAS.py summary -f fasta -d dna -i ' ${i} ' -o ' ${i}'.mafft.trimmed.summary' >> amas_trimmed_commands; done
srun parallel -j 10 < amas_trimmed_commands
for i in *mafft.out; do echo 'AMAS.py summary -f fasta -d dna -i ' ${i} ' -o ' ${i}'.mafft.untrimmed.summary' >> amas_UNtrimmed_commands; done
srun parallel -j 10 < amas_UNtrimmed_commands
## Generating merged summary tables
### Make the title rows
head -1 EOG09070IRB_nt.fasta.mafft.out.mafft.trimmed.mafft.trimmed.summary > trimmed.summary.merged.header
head -1 EOG09070IRB_nt.fasta.mafft.out.mafft.untrimmed.summary > untrimmed.summary.merged.header
### Add data to merged files
for i in *mafft.trimmed.summary; do tail -1 ${i} >> trimmed.summary.merged; echo \t >> trimmed.summary.merged; done
cat trimmed.summary.merged.header trimmed.summary.merged > trimmed.summary.merged.tsv
for i in *mafft.untrimmed.summary; do tail -1 ${i} >> untrimmed.summary.merged; echo \t >> untrimmed.summary.merged; done
cat untrimmed.summary.merged.header untrimmed.summary.merged > 
